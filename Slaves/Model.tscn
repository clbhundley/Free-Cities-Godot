[gd_scene load_steps=5 format=2]

[ext_resource path="res://Slaves/Models/Female/Hair/hair female 2.obj" type="ArrayMesh" id=1]
[ext_resource path="res://Slaves/Models/Female/female normal.obj" type="ArrayMesh" id=2]

[sub_resource type="GDScript" id=1]
script/source = "extends Spatial

onready var _slave = owner

func _ready():
	var gender = _slave.gender.trim_prefix(\"Trans\").capitalize()
	if gender == \"Intersex\":
		gender = [\"Male\",\"Female\"][dice.roll(2)]
	
	# match model filenames with figures for to remove this
	var body_type
	if _slave.figure == \"Skinny\":
		body_type = \"thin\"
	elif _slave.figure == \"Average weight\":
		body_type = \"normal\"
	elif _slave.figure == \"Plush\":
		if gender == \"Male\":
			body_type = \"fat\"
		else:
			body_type = \"thicc\"
	elif _slave.figure == \"Overweight\":
		body_type = \"fat\"
	else:
		body_type = _slave.figure.to_lower()
	var load_str1 = 'res://Slaves/Models/%s/%s %s.obj'%[gender,gender.to_lower(),body_type]
	var body_mesh = load(load_str1)
	$Body.mesh = body_mesh

	# use Skin in MeshInstance?
	var skin_material = SpatialMaterial.new()
	skin_material.albedo_color = _slave.skin_color
	$Body.set_surface_material(0, skin_material)
	$Body.get_surface_material(0).set_cull_mode(2)
	
#	var hair_type
#	if _slave.hair_style == \"Skinny\":
#		hair_type = \"thin\"
#	elif _slave.hair_style == \"Average weight\":
#		hair_type = \"normal\"
#	elif _slave.hair_style == \"Plush\":
#		hair_type = \"thicc\"
#	elif _slave.hair_style == \"Overweight\":
#		hair_type = \"fat\"
	if _slave.hair_style == \"none\":
		$Hair.mesh = null
		return
	var styles = [\"straight\", \"wavy\", \"curly\"]
	var str2 = 'res://Slaves/Models/%s/Hair/hair %s %s.obj'
	var load_str2 = str2%[gender,gender.to_lower(),str(styles.find(_slave.hair_style)+1)]
	var hair_mesh = load(load_str2)
	$Hair.mesh = hair_mesh
	var hair_material = SpatialMaterial.new()
	hair_material.albedo_color = _slave.hair_color
	$Hair.set_surface_material(0, hair_material)
	$Hair.get_surface_material(0).set_cull_mode(2)
	
	#$Head.get_surface_material(0).albedo_color = _slave.hair_color
	#body.get_surface_material(0).albedo_color = _slave.skin_color
"

[sub_resource type="BoxShape" id=2]

[node name="Model" type="KinematicBody"]
script = SubResource( 1 )

[node name="CollisionShape" type="CollisionShape" parent="."]
shape = SubResource( 2 )

[node name="Hair" type="MeshInstance" parent="."]
mesh = ExtResource( 1 )
material/0 = null

[node name="Body" type="MeshInstance" parent="."]
mesh = ExtResource( 2 )
material/0 = null

[node name="SpotLight" type="SpotLight" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1.63281, 8.08879 )
spot_range = 14.0

[node name="SpotLight2" type="SpotLight" parent="."]
transform = Transform( 1, 0, 0, 0, -0.50391, 0.863756, 0, -0.863756, -0.50391, 0, 16.5226, -10.2768 )
spot_range = 30.0
